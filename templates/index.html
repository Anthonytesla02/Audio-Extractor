<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Music Player</title>
    <link rel="manifest" href="/manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="app-container">
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="library">
                <span class="material-icons-round">library_music</span>
                <span class="nav-label">Library</span>
            </button>
            <button class="nav-item" data-view="add">
                <span class="material-icons-round">add_circle</span>
                <span class="nav-label">Add Song</span>
            </button>
        </nav>

        <main class="main-content">
            <section id="library-view" class="view active">
                <header class="view-header">
                    <h1>My Library</h1>
                    <span class="song-count" id="song-count">0 songs</span>
                </header>
                <div class="song-list" id="song-list">
                    <div class="empty-state" id="empty-state">
                        <span class="material-icons-round empty-icon">library_music</span>
                        <h3>No songs yet</h3>
                        <p>Add your first song from YouTube</p>
                        <button class="btn-primary" onclick="switchView('add')">
                            <span class="material-icons-round">add</span>
                            Add Song
                        </button>
                    </div>
                </div>
            </section>

            <section id="add-view" class="view">
                <header class="view-header">
                    <h1>Add Song</h1>
                    <p>Paste a YouTube URL to add to your library</p>
                </header>
                <div class="add-form">
                    <div class="input-wrapper">
                        <span class="material-icons-round input-icon">link</span>
                        <input type="text" id="youtube-url" placeholder="Paste YouTube URL here...">
                        <button class="btn-icon" id="paste-btn" onclick="pasteFromClipboard()">
                            <span class="material-icons-round">content_paste</span>
                        </button>
                    </div>
                    <button class="btn-primary btn-full" id="extract-btn" onclick="extractInfo()">
                        <span class="material-icons-round">search</span>
                        Extract Info
                    </button>
                </div>

                <div class="preview-card" id="preview-card" style="display: none;">
                    <div class="preview-loading" id="preview-loading">
                        <div class="spinner"></div>
                        <p>Extracting info...</p>
                    </div>
                    <div class="preview-content" id="preview-content" style="display: none;">
                        <img id="preview-thumbnail" src="" alt="Thumbnail" class="preview-thumbnail">
                        <div class="preview-info">
                            <h3 id="preview-title"></h3>
                            <p id="preview-artist"></p>
                            <p id="preview-duration" class="duration"></p>
                        </div>
                        <button class="btn-download" id="download-btn" onclick="downloadSong()">
                            <span class="material-icons-round">download</span>
                            Download to Library
                        </button>
                        <div class="download-progress" id="download-progress" style="display: none;">
                            <div class="progress-bar">
                                <div class="progress-fill"></div>
                            </div>
                            <p>Downloading...</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <div class="mini-player" id="mini-player" style="display: none;">
            <div class="mini-player-content" onclick="openFullPlayer()">
                <img id="mini-thumbnail" src="" alt="" class="mini-thumbnail">
                <div class="mini-info">
                    <span id="mini-title" class="mini-title"></span>
                    <span id="mini-artist" class="mini-artist"></span>
                </div>
            </div>
            <div class="mini-controls">
                <button class="btn-icon" onclick="event.stopPropagation(); togglePlay()">
                    <span class="material-icons-round" id="mini-play-icon">play_arrow</span>
                </button>
                <button class="btn-icon" onclick="event.stopPropagation(); playNext()">
                    <span class="material-icons-round">skip_next</span>
                </button>
            </div>
            <div class="mini-progress" id="mini-progress-bar"></div>
        </div>

        <div class="full-player" id="full-player">
            <div class="full-player-header">
                <button class="btn-icon" onclick="closeFullPlayer()">
                    <span class="material-icons-round">keyboard_arrow_down</span>
                </button>
                <span>Now Playing</span>
                <button class="btn-icon" id="more-btn">
                    <span class="material-icons-round">more_vert</span>
                </button>
            </div>
            <div class="full-player-content">
                <div class="album-art-container">
                    <img id="full-thumbnail" src="" alt="" class="album-art">
                </div>
                <div class="song-details">
                    <h2 id="full-title"></h2>
                    <p id="full-artist"></p>
                </div>
                <div class="progress-container">
                    <input type="range" id="progress-slider" class="progress-slider" min="0" max="100" value="0">
                    <div class="time-display">
                        <span id="current-time">0:00</span>
                        <span id="total-time">0:00</span>
                    </div>
                </div>
                <div class="player-controls">
                    <button class="btn-icon control-btn" onclick="toggleShuffle()">
                        <span class="material-icons-round" id="shuffle-icon">shuffle</span>
                    </button>
                    <button class="btn-icon control-btn" onclick="playPrevious()">
                        <span class="material-icons-round">skip_previous</span>
                    </button>
                    <button class="btn-play" onclick="togglePlay()">
                        <span class="material-icons-round" id="full-play-icon">play_arrow</span>
                    </button>
                    <button class="btn-icon control-btn" onclick="playNext()">
                        <span class="material-icons-round">skip_next</span>
                    </button>
                    <button class="btn-icon control-btn" onclick="toggleRepeat()">
                        <span class="material-icons-round" id="repeat-icon">repeat</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <audio id="audio-player"></audio>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/sw.js').catch(err => console.log('SW error:', err));
        }
    </script>
</body>
</html>
